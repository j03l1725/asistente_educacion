{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center space-x-3">
        <i data-lucide="check-circle" class="w-6 h-6 text-neon"></i>
        <h2 class="text-2xl font-display font-bold text-text-primary">Calificar con Rúbrica</h2>
    </div>

    <form id="calificar-form" enctype="multipart/form-data" class="space-y-6">
        <div class="space-y-2">
            <label for="rubrica" class="block text-sm font-medium text-text-primary">Rúbrica (JSON) *</label>
            <textarea id="rubrica" name="rubrica" rows="8" placeholder='{"nombre":"Test","criterios":[{"nombre":"Content","peso":0.5,"niveles":[{"nombre":"Good","descriptor":"...","puntaje":10}]}]}' required
                      class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-text-primary placeholder-text-muted focus:ring-neon focus:border-neon/50 transition-all duration-200 font-mono text-sm resize-none"></textarea>
            <p class="text-xs text-text-muted">Ingresa la rúbrica en formato JSON válido.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
                <label for="tipo" class="block text-sm font-medium text-text-primary">Tipo de Evidencia *</label>
                <select id="tipo" name="tipo" required
                        class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-text-primary focus:ring-neon focus:border-neon/50 transition-all duration-200">
                    <option value="texto">Texto</option>
                    <option value="archivo">Archivo</option>
                    <option value="url">URL</option>
                </select>
            </div>
            <div class="space-y-2">
                <label for="metadata" class="block text-sm font-medium text-text-primary">Metadata (opcional)</label>
                <input type="text" id="metadata" name="metadata" placeholder='{}'
                       class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-text-primary placeholder-text-muted focus:ring-neon focus:border-neon/50 transition-all duration-200">
            </div>
        </div>

        <div class="space-y-2">
            <label for="contenido" class="block text-sm font-medium text-text-primary">Contenido de Evidencia *</label>
            <textarea id="contenido" name="contenido" rows="4" required
                      class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-text-primary placeholder-text-muted focus:ring-neon focus:border-neon/50 transition-all duration-200 resize-none"></textarea>
            <input type="file" id="file-input" name="contenido" accept=".pdf,.txt" class="hidden">
            <p class="text-xs text-text-muted">Ingresa el texto de la evidencia o selecciona un archivo.</p>
        </div>

        <button type="submit" class="w-full md:w-auto px-8 py-3 bg-neon/20 hover:bg-neon/30 text-neon border border-neon/30 rounded-xl font-medium transition-all duration-200 focus:ring-neon focus:outline-none">
            <i data-lucide="calculator" class="w-5 h-5 inline mr-2"></i>
            Calificar
        </button>
    </form>
</div>

<script>
    document.getElementById('tipo').addEventListener('change', function() {
        const tipo = this.value;
        const textarea = document.getElementById('contenido');
        const fileInput = document.getElementById('file-input');
        if (tipo === 'archivo') {
            textarea.style.display = 'none';
            fileInput.style.display = 'block';
            textarea.required = false;
            fileInput.required = true;
        } else {
            textarea.style.display = 'block';
            fileInput.style.display = 'none';
            textarea.required = true;
            fileInput.required = false;
        }
    });
    // Initialize
    document.getElementById('tipo').dispatchEvent(new Event('change'));
</script>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/calificar.js') }}"></script>
{% endblock %}